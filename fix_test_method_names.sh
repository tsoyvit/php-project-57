#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ —Ç–µ—Å—Ç–æ–≤ test_snake_case -> testCamelCase
# –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–∞–ø–∫–µ tests/, –∏–∑–º–µ–Ω—è–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ

echo "üîç –ü–æ–∏—Å–∫ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Ç–µ—Å—Ç–æ–≤..."

find tests/ -type f -name "*.php" | while read file; do
  perl -i -pe '
    # –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è snake_case –≤ PascalCase (–¥–ª—è –º–µ—Ç–æ–¥–∞ –ø–æ—Å–ª–µ "test")
    sub pascal {
      my $s = shift;
      $s =~ s/_([a-z])/uc($1)/ge;  # –ø–æ–¥–Ω–∏–º–∞–µ–º –∫–∞–∂–¥—É—é –±—É–∫–≤—É –ø–æ—Å–ª–µ _
      $s =~ s/^[a-z]/uc($&)/e;     # –ø–µ—Ä–≤—É—é –±—É–∫–≤—É –¥–µ–ª–∞–µ–º –∑–∞–≥–ª–∞–≤–Ω–æ–π
      return $s;
    }

    # –ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥—ã test_something_like_this –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ testSomethingLikeThis
    s/(function\s+)test_([a-z0-9_]+)(\s*\()/
      $1 . "test" . pascal($2) . $3
    /eg;
  ' "$file"

  echo "‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω —Ñ–∞–π–ª: $file"
done

echo "üéâ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
